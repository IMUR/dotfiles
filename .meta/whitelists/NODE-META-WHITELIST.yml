# Node .meta/ Directory Whitelist
# Defines which files/directories are allowed in node-level .meta/
# This is the TEMPLATE whitelist - deployed to all nodes

version: "1.0"
last_updated: "2025-10-08"
purpose: "Define allowed structure for node-level meta-management"

# Files explicitly allowed in node .meta/ directory
whitelist:

  # Category: Node Identity & Principles
  node_identity:
    - META-TYPE.txt           # Identifies this as node-level metadata (content: "node")
    - NODE-PRINCIPLES.md      # Core principles for this node's configuration
    - NODE-README.md          # Overview of node .meta/ structure

  # Category: Node Documentation
  node_docs:
    - README.md               # Detailed node-specific documentation (existing)

# Directories allowed in node .meta/
allowed_directories:
  - ssot/                     # Node-level SSOT discovery (THE ONLY NON-META-STRUCTURAL CONTENT)
  - ai/                       # AI operational context (node-specific)
  - schemas/                  # Node-specific validation schemas
  - generation/               # Config generation templates (node-specific)
  - validation/               # Node-specific validation tools
  - cache/                    # Temporary/generated files (gitignored)
  - archive/                  # Archived/deprecated meta-management files

# Required structure (MUST exist)
required:
  files:
    - META-TYPE.txt           # Must contain "node"
    - NODE-PRINCIPLES.md      # Must define node identity and scope
    - NODE-README.md          # Must explain node .meta/ structure

  directories:
    - ssot/                   # Must have node SSOT discovery

# Prohibited in node .meta/
prohibited:
  - "*.bak"                   # No backup files
  - "*.tmp"                   # No temporary files
  - "*.log"                   # No log files (use cache/ if needed)
  - ".DS_Store"               # No OS metadata
  - "thumbs.db"               # No OS metadata

# Special rules
special_rules:
  ssot_directory:
    description: "SSOT is the ONLY non-meta-structural content in .meta/"
    allowed_files:
      - discover-node-truth.sh      # Node discovery script
      - node-truth.yaml             # Generated truth (gitignored)
      - README.md                   # SSOT documentation
      - .gitignore                  # Ignore generated files
    purpose: "Auto-discover THIS node's infrastructure state"

  existing_directories:
    description: "Directories that may exist on cooperator (legacy)"
    ai:
      purpose: "AI operational context and knowledge base"
      note: "May not exist on all nodes"
    generation:
      purpose: "Config generation templates (Jinja2)"
      note: "May not exist on all nodes"
    schemas:
      purpose: "JSON schemas for validation"
      note: "May not exist on all nodes"
    validation:
      purpose: "Validation scripts and rules"
      note: "May not exist on all nodes"

# Node-specific guidelines
guidelines:
  - "Node .meta/ should be minimal and focused on node identity"
  - "SSOT discovery is the primary operational content"
  - "Avoid duplicating cluster-level meta-management"
  - "Node-specific schemas/AI context only if truly node-unique"
  - "Cache directory for generated/temporary files (gitignored)"

# Comparison to Cluster .meta/
cluster_vs_node:
  cluster_meta:
    location: "colab-config/.meta/"
    scope: "All 3 nodes + cluster-wide infrastructure"
    contains:
      - "First principles and derived principles"
      - "Document standards and alignment rules"
      - "Cluster-wide SSOT (all nodes + DNS)"
      - "Node deployment templates"

  node_meta:
    location: "~/Projects/<user>-config/.meta/"
    scope: "THIS node only"
    contains:
      - "Node identity and principles"
      - "Node-level SSOT (local discovery)"
      - "Node-specific AI context (optional)"
      - "Node-specific schemas (optional)"

# Validation
validation:
  script: ".meta/validation/check-meta-whitelist.sh"
  usage: |
    # Check node .meta/ structure compliance
    ./.meta/validation/check-meta-whitelist.sh

    # Show violations
    ./.meta/validation/check-meta-whitelist.sh --verbose

# Deployment
deployment:
  method: "Deployed via colab-config/.meta/DEPLOY-NODE-META.sh"
  target_location: "~/Projects/<user>-config/.meta/NODE-META-WHITELIST.yml"
  note: "Each node gets identical whitelist template"
