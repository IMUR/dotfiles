{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://crtr-config/schemas/domain.schema.json",
  "title": "Domain Routing",
  "description": "Schema for domain â†’ service routing configuration",
  "type": "object",
  "properties": {
    "gateway_ip": {
      "type": "string",
      "pattern": "^192\\.168\\.254\\.10$"
    },
    "external_target": {
      "type": "string",
      "description": "External DDNS target for CNAME records"
    },
    "domains": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["fqdn", "service", "backend"],
        "properties": {
          "fqdn": {
            "type": "string",
            "pattern": "^[a-z0-9-]+\\.ism\\.la$",
            "description": "Fully qualified domain name"
          },
          "service": {
            "type": "string",
            "description": "Service name (must exist in services.yml)"
          },
          "backend": {
            "type": "string",
            "pattern": "^(localhost|127\\.0\\.0\\.1|https?://localhost|https?://127\\.0\\.0\\.1|192\\.168\\.254\\.[0-9]{1,3}):[0-9]{1,5}$",
            "description": "Backend URL (host:port)"
          },
          "type": {
            "type": "string",
            "enum": ["standard", "websocket", "sse", "https_backend", "static"],
            "default": "standard",
            "description": "Reverse proxy type"
          },
          "local_ip": {
            "type": "string",
            "pattern": "^192\\.168\\.254\\.[0-9]{1,3}$",
            "description": "Local DNS override IP"
          },
          "external_dns": {
            "type": "boolean",
            "default": true,
            "description": "Create external DNS CNAME record"
          },
          "tls_skip_verify": {
            "type": "boolean",
            "default": false,
            "description": "Skip TLS verification for HTTPS backends"
          },
          "static_response": {
            "type": "string",
            "description": "Static response for type: static"
          },
          "redirect_target": {
            "type": "string",
            "description": "Redirect target URL"
          }
        },
        "allOf": [
          {
            "if": {
              "properties": { "type": { "const": "static" } }
            },
            "then": {
              "required": ["static_response"]
            }
          }
        ]
      }
    }
  },
  "required": ["gateway_ip", "domains"]
}
