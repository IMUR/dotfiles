---
# Service definitions for cooperator
# Schema: .meta/schemas/service.schema.json
# Source: COOPERATOR-ASPECTS.md

services:
  # Edge Services Infrastructure
  caddy:
    type: systemd
    enabled: true
    status: running
    binary: /usr/bin/caddy
    unit_file: package
    config: /etc/caddy/Caddyfile
    ports: [80, 443]
    bind: 0.0.0.0
    restart: on-failure
    notes: "v2.8.4, SSL certificates active"

  pihole:
    type: systemd
    enabled: true
    status: running
    binary: /usr/bin/pihole-FTL
    unit_file: package
    config: /etc/pihole/
    ports: [53, 8080]
    bind: 0.0.0.0
    restart: on-failure
    notes: "v6.2.3, native install, dns.ism.la"

  cockpit:
    type: systemd
    enabled: true
    status: running
    binary: /usr/lib/cockpit/cockpit-ws
    unit_file: package
    port: 9090
    bind: 127.0.0.1
    restart: on-failure
    notes: "v337-1, mng.ism.la"

  # Storage (Not yet configured)
  nfs-kernel-server:
    type: systemd
    enabled: false
    status: not-installed
    binary: /usr/sbin/nfs-server
    unit_file: package
    config: /etc/exports
    port: 2049
    restart: on-failure

  # Container Runtime
  docker:
    type: systemd
    enabled: true
    status: running
    binary: /usr/bin/dockerd
    unit_file: package
    restart: on-failure
    notes: "v28.5.1"

  # Docker Compose Services (Running)
  infisical:
    type: docker-compose
    enabled: true
    status: running
    compose_file: /home/crtr/docker/infisical/docker-compose.yml
    services: [postgres, redis, infisical]
    port: 8081
    bind: 127.0.0.1
    restart: unless-stopped
    notes: "Secrets management, env.ism.la"
    dependencies:
      - docker

  # Docker Container Services (Running)
  openwebui:
    type: docker
    enabled: true
    status: running
    image: ghcr.io/open-webui/open-webui:main
    container_name: openwebui
    port: 8082
    bind: 127.0.0.1
    data: /home/crtr/docker/openwebui
    restart: unless-stopped
    notes: "AI chat interface, cht.ism.la, requires HTTP/1.1 for WebSocket"
    dependencies:
      - docker

  searxng:
    type: docker
    enabled: true
    status: running
    image: searxng/searxng:latest
    container_name: searxng
    port: 8083
    bind: 127.0.0.1
    data: /home/crtr/docker/searxng
    restart: unless-stopped
    notes: "Meta search engine, sch.ism.la, JSON format enabled"
    dependencies:
      - docker

  jupyter:
    type: docker
    enabled: true
    status: running
    image: jupyter/minimal-notebook:latest
    container_name: jupyter
    port: 8888
    bind: 0.0.0.0
    data: /home/crtr/docker/jupyter
    restart: unless-stopped
    notes: "Code execution backend for OpenWebUI, token auth, JupyterLab enabled"
    dependencies:
      - docker

  # Services Pending Installation
  atuin-server:
    type: systemd
    enabled: false
    status: not-installed
    binary: /usr/local/bin/atuin
    unit_file: /etc/systemd/system/atuin-server.service
    port: 8811
    bind: 0.0.0.0
    data: /home/crtr/.local/share/atuin
    user: crtr
    restart: on-failure

  semaphore:
    type: systemd
    enabled: false
    status: not-installed
    binary: /usr/local/bin/semaphore
    unit_file: /etc/systemd/system/semaphore.service
    port: 3000
    bind: 127.0.0.1
    notes: "smp.ism.la, deployment automation"

  gotty:
    type: systemd
    enabled: false
    status: not-installed
    binary: /usr/local/bin/gotty
    unit_file: /etc/systemd/system/gotty.service
    port: 7681
    bind: 127.0.0.1
    notes: "ssh.ism.la, web terminal"

  # Docker Compose Services (Running)
  n8n:
    type: docker-compose
    enabled: true
    status: running
    compose_file: /home/crtr/docker/n8n/docker-compose.yml
    image: n8nio/n8n:latest
    port: 5678
    bind: 127.0.0.1
    data: /home/crtr/docker/n8n/data
    env_file: /home/crtr/docker/n8n/.env
    restart: unless-stopped
    notes: "Workflow automation, n8n.ism.la, fresh install v1.118.2"
    dependencies:
      - docker

  headscale:
    type: docker-compose
    enabled: true
    status: running
    compose_file: /home/crtr/docker/headscale/docker-compose.yml
    image: headscale/headscale:v0.27.0
    port: 8084
    bind: 0.0.0.0
    data: /home/crtr/docker/headscale/data
    config: /home/crtr/docker/headscale/config
    restart: unless-stopped
    notes: "Self-hosted Tailscale controller, vpn.ism.la, mesh VPN for cluster"
    dependencies:
      - docker
