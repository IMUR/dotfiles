{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://crtr-config/schemas/domains.schema.json",
  "title": "Domains Configuration Schema",
  "description": "Schema for domain routing configuration",
  "type": "object",
  "required": ["gateway_ip", "domains"],
  "properties": {
    "gateway_ip": {
      "type": "string",
      "format": "ipv4",
      "description": "IP address of the gateway node"
    },
    "external_target": {
      "type": "string",
      "format": "hostname",
      "description": "External DDNS hostname target"
    },
    "domains": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["fqdn", "service", "backend", "type", "local_ip"],
        "properties": {
          "fqdn": {
            "type": "string",
            "format": "hostname",
            "description": "Fully qualified domain name"
          },
          "service": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$",
            "description": "Service name this domain routes to"
          },
          "backend": {
            "type": "string",
            "pattern": "^(https?://)?([a-z0-9.-]+|localhost|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[0-9]{1,5})?$",
            "description": "Backend URL or host:port"
          },
          "type": {
            "type": "string",
            "enum": ["standard", "https_backend", "websocket", "sse", "grpc"],
            "description": "Connection type for reverse proxy"
          },
          "local_ip": {
            "type": "string",
            "format": "ipv4",
            "description": "Local IP to resolve this domain to"
          },
          "external_dns": {
            "type": "boolean",
            "description": "Whether to create external DNS record"
          },
          "tls_skip_verify": {
            "type": "boolean",
            "description": "Skip TLS verification for backend (use with caution)"
          },
          "headers": {
            "type": "object",
            "patternProperties": {
              "^[A-Za-z0-9-]+$": {
                "type": "string"
              }
            },
            "description": "Custom headers to add"
          }
        },
        "additionalProperties": false
      }
    }
  }
}
